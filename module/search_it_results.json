{"id":"2","key":"search_it_results","name":"Suchergebnis-Treffer","output":"<section class=\"search_it-modul\">\r\n    <p class=\"search_it-demotitle\">Suchergebnisse<\/p>\r\n\r\n<?php\r\n$server = rtrim(rex::getServer(),\"\/\"); \/\/ Aktuelle Website-Adresse ohne Slash am Ende;\r\n$searchterm = rex_request('search', 'string', false); \/\/ GET\/POST-Anfrage: Casting als String\r\n$limit = 50; \/\/ Anzahl Treffer pro Seite\r\n$start = rex_request('start', 'int', 0);\r\n\r\nif($searchterm) { \/\/ Wenn ein Suchbegriff eingegeben wurde\r\n    $search_it = new search_it(); \/\/ Suche initialisieren\r\n    $search_it->setLimit($start, $limit); \/\/ Anzahl der Suchergebnisse auf $limit beschr\u00e4nken\r\n    $result = $search_it->search($searchterm); \/\/ Suche ausf\u00fchren\r\n\r\n    if($result['count']) { \/\/ Wenn Ergebnisse vorhanden sind...\r\n?>\r\n\r\n<h2 class=\"search_it-headline\">Suchergebnisse<\/h2>\r\n<ul class=\"search_it-results\">\r\n\r\n<?php\r\n\r\n        \/* Paginierung *\/\r\n        $pagination = new rex_fragment(); \r\n        $pagination->setVar('searchterm', $searchterm);\r\n        $pagination->setVar('limit', $limit);\r\n        $pagination->setVar('start', $start);\r\n        $pagination->setVar('result', $result);\r\n        echo $pagination->parse('search_it-result-pagination.php');\r\n\r\n        \/* Suchergebnis-Treffer *\/\r\n        foreach($result['hits'] as $hit) { \/\/ Jeder Treffer in $hit\r\n            $fragment = new rex_fragment(); \/\/ Fragment zur Ausgabe des Treffers erstellen\r\n\r\n            if($hit['type'] == 'article') { \/\/ Treffer vom Typ REDAXO-Artikel\r\n\r\n                $article = rex_article::get($hit['fid']); \/\/ REDAXO-Artikel-Objekt holen\r\n\r\n\r\n                \/\/ URL des Suchegebnis-Treffers, falls YRewrite genutzt wird\r\n                if(rex_addon::get('yrewrite')->isAvailable()) {\r\n                    $domain = rex_yrewrite::getDomainByArticleId($hit['fid'], $hit['clang']);\r\n                    $url = rtrim($domain->getUrl(), \"\/\");\r\n                } else {\r\n                    $url = $server.rex_getUrl($hit['fid'], $hit['clang'], array('search_highlighter' => $searchterm));\r\n                }\r\n\r\n                $fragment->setVar('title', $article->getName());\r\n                $fragment->setVar('teaser', $hit['highlightedtext']);\r\n                $fragment->setVar('url', $url);\r\n                echo $fragment->parse('search_it-result-list-item.php');\r\n\r\n            } else if($hit['type'] == 'url') { \/\/ Treffer vom Typ URL-Addon-Profil\r\n\r\n                $url_sql = rex_sql::factory();\r\n                $url_sql->setTable(search_it_getUrlAddOnTableName());\r\n                $url_sql->setWhere(\"url_hash = '\". $hit['fid'] .\"'\");\r\n                if ($url_sql->select('article_id, clang_id, profile_id, data_id, seo')) {\r\n                    $url_info = json_decode($url_sql->getValue('seo'), true);\r\n                    $url_profile = \\Url\\Profile::get($url_sql->getValue('profile_id'));\r\n\r\n                    \/\/ get yrewrite article domain\r\n                    $hit_server = $server;\r\n                    if(rex_addon::get('yrewrite')->isAvailable()) {\r\n                        $hit_domain = rex_yrewrite::getDomainByArticleId($url_sql->getValue('article_id'), $url_sql->getValue('clang_id'));\r\n                        $hit_server = rtrim($hit_domain->getUrl(), \"\/\");\r\n                    }\r\n                    $url = $hit_server . rex_getUrl($url_sql->getValue('article_id'), $url_sql->getValue('clang_id'), [$url_profile->getNamespace() => $url_sql->getValue('data_id'), 'search_highlighter' => $searchterm]);\r\n\r\n                    $fragment->setVar('title', $url_info['title']);\r\n                    $fragment->setVar('teaser', $hit['highlightedtext']);\r\n                    $fragment->setVar('url',url);\r\n\r\n                    echo $fragment->parse('search_it-result-list-item.php');\r\n                }\r\n            }\r\n            else {\r\n                echo $fragment->parse('search_it-result-list-missing-type.php');\r\n            }\r\n\r\n        }\r\n?>\r\n\r\n<\/ul>\r\n\r\n<?php\r\n    \/* Paginierung *\/\r\n    echo $pagination->parse('search_it-result-pagination.php');\r\n\r\n    } else if(!$result['count']) { \/\/ Wenn keine Suchergebnisse vorhanden sind....\r\n        $fragment = new rex_fragment();\r\n        $fragment->setVar('searchterm', $searchterm);\r\n        echo $fragment->parse('search_it-result-no-result.php');\r\n    }\r\n}\r\n?>\r\n\r\n<\/section>","input":"","createdate":"2020-04-14 17:18:59","createuser":"admin","updatedate":"2020-04-20 11:56:12","updateuser":"admin","attributes":null,"revision":"0"}
